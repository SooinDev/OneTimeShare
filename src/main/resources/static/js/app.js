// Translations
const translations = {
    ko: {
        title: 'ì¼íšŒì„± ë°ì´í„° ê³µìœ ',
        subtitle: 'í•œ ë²ˆë§Œ ë³¼ ìˆ˜ ìˆëŠ” ì•ˆì „í•œ ë°ì´í„° ê³µìœ  ì„œë¹„ìŠ¤',
        tabText: 'í…ìŠ¤íŠ¸',
        tabPassword: 'ë¹„ë°€ë²ˆí˜¸',
        tabFile: 'íŒŒì¼',
        textPlaceholder: 'ê³µìœ í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...',
        passwordPlaceholder: 'ê³µìœ í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...',
        fileUploadText: 'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”',
        fileUploadLimit: 'ìµœëŒ€ 10MB',
        expiryLabel: 'ë§Œë£Œ ì‹œê°„:',
        expiry1h: '1ì‹œê°„',
        expiry24h: '24ì‹œê°„',
        expiry3d: '3ì¼',
        expiry7d: '7ì¼',
        createBtn: 'ê³µìœ  ë§í¬ ìƒì„±',
        creatingBtn: 'ìƒì„± ì¤‘...',
        successTitle: 'ê³µìœ  ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!',
        copyBtn: 'ë³µì‚¬',
        copiedBtn: 'âœ“ ë³µì‚¬ë¨!',
        warningText: 'ì´ ë§í¬ëŠ” í•œ ë²ˆë§Œ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—´ëŒ í›„ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.',
        createNewBtn: 'ìƒˆë¡œ ë§Œë“¤ê¸°',
        footerText: 'ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ë©° ì¡°íšŒ ì‹œ ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤',
        sharedDataTitle: 'ê³µìœ ëœ ë°ì´í„°',
        sharedWarning: 'ì´ í˜ì´ì§€ë¥¼ ë– ë‚˜ë©´ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.',
        passwordLabel: 'ë¹„ë°€ë²ˆí˜¸',
        textLabel: 'í…ìŠ¤íŠ¸',
        downloadBtn: 'ë‹¤ìš´ë¡œë“œ',
        newShareBtn: 'ìƒˆ ê³µìœ  ë§Œë“¤ê¸°',
        expiredTitle: 'ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
        fileSizeError: 'íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        textRequired: 'í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        passwordRequired: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        fileRequired: 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
        linkCopied: 'ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!',
        contentCopied: 'ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!',
        copyFailed: 'ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
        serverError: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
    },
    en: {
        title: 'One-Time Share',
        subtitle: 'Secure data sharing service that can be viewed only once',
        tabText: 'Text',
        tabPassword: 'Password',
        tabFile: 'File',
        textPlaceholder: 'Enter text to share...',
        passwordPlaceholder: 'Enter password to share...',
        fileUploadText: 'Click or drag file here',
        fileUploadLimit: 'Max 10MB',
        expiryLabel: 'Expiry Time:',
        expiry1h: '1 hour',
        expiry24h: '24 hours',
        expiry3d: '3 days',
        expiry7d: '7 days',
        createBtn: 'Create Share Link',
        creatingBtn: 'Creating...',
        successTitle: 'Share link created!',
        copyBtn: 'Copy',
        copiedBtn: 'âœ“ Copied!',
        warningText: 'This link can only be opened once. It will be automatically deleted after viewing.',
        createNewBtn: 'Create New',
        footerText: 'All data is encrypted and deleted immediately upon viewing',
        sharedDataTitle: 'Shared Data',
        sharedWarning: 'Data will be permanently deleted when you leave this page.',
        passwordLabel: 'Password',
        textLabel: 'Text',
        downloadBtn: 'Download',
        newShareBtn: 'Create New Share',
        expiredTitle: 'Link Expired',
        fileSizeError: 'File size cannot exceed 10MB.',
        textRequired: 'Please enter text.',
        passwordRequired: 'Please enter password.',
        fileRequired: 'Please select a file.',
        linkCopied: 'Link copied to clipboard!',
        contentCopied: 'Content copied to clipboard!',
        copyFailed: 'Copy failed.',
        serverError: 'A server error occurred.'
    },
    ja: {
        title: 'ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ã‚·ã‚§ã‚¢',
        subtitle: 'ä¸€åº¦ã ã‘é–²è¦§ã§ãã‚‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹',
        tabText: 'ãƒ†ã‚­ã‚¹ãƒˆ',
        tabPassword: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
        tabFile: 'ãƒ•ã‚¡ã‚¤ãƒ«',
        textPlaceholder: 'å…±æœ‰ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',
        passwordPlaceholder: 'å…±æœ‰ã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',
        fileUploadText: 'ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°',
        fileUploadLimit: 'æœ€å¤§10MB',
        expiryLabel: 'æœ‰åŠ¹æœŸé™:',
        expiry1h: '1æ™‚é–“',
        expiry24h: '24æ™‚é–“',
        expiry3d: '3æ—¥',
        expiry7d: '7æ—¥',
        createBtn: 'å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ',
        creatingBtn: 'ä½œæˆä¸­...',
        successTitle: 'å…±æœ‰ãƒªãƒ³ã‚¯ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼',
        copyBtn: 'ã‚³ãƒ”ãƒ¼',
        copiedBtn: 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆã¿ï¼',
        warningText: 'ã“ã®ãƒªãƒ³ã‚¯ã¯ä¸€åº¦ã ã‘é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚é–²è¦§å¾Œã¯è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚',
        createNewBtn: 'æ–°è¦ä½œæˆ',
        footerText: 'ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã€é–²è¦§æ™‚ã«å³åº§ã«å‰Šé™¤ã•ã‚Œã¾ã™',
        sharedDataTitle: 'å…±æœ‰ãƒ‡ãƒ¼ã‚¿',
        sharedWarning: 'ã“ã®ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ°¸ä¹…ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚',
        passwordLabel: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
        textLabel: 'ãƒ†ã‚­ã‚¹ãƒˆ',
        downloadBtn: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
        newShareBtn: 'æ–°ã—ã„å…±æœ‰ã‚’ä½œæˆ',
        expiredTitle: 'ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸ',
        fileSizeError: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBã‚’è¶…ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚',
        textRequired: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
        passwordRequired: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
        fileRequired: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚',
        linkCopied: 'ãƒªãƒ³ã‚¯ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼',
        contentCopied: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸï¼',
        copyFailed: 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
        serverError: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
    },
    zh: {
        title: 'ä¸€æ¬¡æ€§åˆ†äº«',
        subtitle: 'åªèƒ½æŸ¥çœ‹ä¸€æ¬¡çš„å®‰å…¨æ•°æ®å…±äº«æœåŠ¡',
        tabText: 'æ–‡æœ¬',
        tabPassword: 'å¯†ç ',
        tabFile: 'æ–‡ä»¶',
        textPlaceholder: 'è¾“å…¥è¦åˆ†äº«çš„æ–‡æœ¬...',
        passwordPlaceholder: 'è¾“å…¥è¦åˆ†äº«çš„å¯†ç ...',
        fileUploadText: 'ç‚¹å‡»æˆ–æ‹–åŠ¨æ–‡ä»¶åˆ°è¿™é‡Œ',
        fileUploadLimit: 'æœ€å¤§10MB',
        expiryLabel: 'è¿‡æœŸæ—¶é—´ï¼š',
        expiry1h: '1å°æ—¶',
        expiry24h: '24å°æ—¶',
        expiry3d: '3å¤©',
        expiry7d: '7å¤©',
        createBtn: 'åˆ›å»ºåˆ†äº«é“¾æ¥',
        creatingBtn: 'åˆ›å»ºä¸­...',
        successTitle: 'åˆ†äº«é“¾æ¥å·²åˆ›å»ºï¼',
        copyBtn: 'å¤åˆ¶',
        copiedBtn: 'âœ“ å·²å¤åˆ¶ï¼',
        warningText: 'æ­¤é“¾æ¥åªèƒ½æ‰“å¼€ä¸€æ¬¡ã€‚æŸ¥çœ‹åå°†è‡ªåŠ¨åˆ é™¤ã€‚',
        createNewBtn: 'æ–°å»º',
        footerText: 'æ‰€æœ‰æ•°æ®å‡ç»è¿‡åŠ å¯†å­˜å‚¨ï¼ŒæŸ¥çœ‹åç«‹å³åˆ é™¤',
        sharedDataTitle: 'å…±äº«æ•°æ®',
        sharedWarning: 'ç¦»å¼€æ­¤é¡µé¢åæ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚',
        passwordLabel: 'å¯†ç ',
        textLabel: 'æ–‡æœ¬',
        downloadBtn: 'ä¸‹è½½',
        newShareBtn: 'åˆ›å»ºæ–°åˆ†äº«',
        expiredTitle: 'é“¾æ¥å·²è¿‡æœŸ',
        fileSizeError: 'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MBã€‚',
        textRequired: 'è¯·è¾“å…¥æ–‡æœ¬ã€‚',
        passwordRequired: 'è¯·è¾“å…¥å¯†ç ã€‚',
        fileRequired: 'è¯·é€‰æ‹©æ–‡ä»¶ã€‚',
        linkCopied: 'é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼',
        contentCopied: 'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼',
        copyFailed: 'å¤åˆ¶å¤±è´¥ã€‚',
        serverError: 'å‘ç”ŸæœåŠ¡å™¨é”™è¯¯ã€‚'
    }
};

// Language and Theme Management
let currentLang = localStorage.getItem('language') || 'ko';
let currentTheme = localStorage.getItem('theme') || 'light';

function setTheme(theme) {
    currentTheme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeIcon();
}

function toggleTheme() {
    setTheme(currentTheme === 'light' ? 'dark' : 'light');
}

function updateThemeIcon() {
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.textContent = currentTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
    }
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    updateLanguageDisplay();
    updatePageContent();
}

function updateLanguageDisplay() {
    const languageBtn = document.querySelector('.language-btn');
    if (languageBtn) {
        const langNames = { ko: 'í•œêµ­ì–´', en: 'English', ja: 'æ—¥æœ¬èª', zh: 'ä¸­æ–‡' };
        const langFlags = { ko: 'ğŸ‡°ğŸ‡·', en: 'ğŸ‡ºğŸ‡¸', ja: 'ğŸ‡¯ğŸ‡µ', zh: 'ğŸ‡¨ğŸ‡³' };
        languageBtn.innerHTML = `<span>${langFlags[currentLang]}</span><span>${langNames[currentLang]}</span>`;
    }

    // Update active state in dropdown
    document.querySelectorAll('.language-option').forEach(option => {
        option.classList.toggle('active', option.dataset.lang === currentLang);
    });
}

function updatePageContent() {
    const t = translations[currentLang];

    // Update common elements
    const elements = {
        '[data-i18n="title"]': t.title,
        '[data-i18n="subtitle"]': t.subtitle,
        '[data-i18n="tabText"]': t.tabText,
        '[data-i18n="tabPassword"]': t.tabPassword,
        '[data-i18n="tabFile"]': t.tabFile,
        '[data-i18n="expiryLabel"]': t.expiryLabel,
        '[data-i18n="createBtn"]': t.createBtn,
        '[data-i18n="footerText"]': t.footerText,
        '[data-i18n="successTitle"]': t.successTitle,
        '[data-i18n="copyBtn"]': t.copyBtn,
        '[data-i18n="warningText"]': t.warningText,
        '[data-i18n="createNewBtn"]': t.createNewBtn,
        '[data-i18n="sharedDataTitle"]': t.sharedDataTitle,
        '[data-i18n="sharedWarning"]': t.sharedWarning,
        '[data-i18n="downloadBtn"]': t.downloadBtn,
        '[data-i18n="newShareBtn"]': t.newShareBtn,
        '[data-i18n="expiredTitle"]': t.expiredTitle
    };

    Object.entries(elements).forEach(([selector, text]) => {
        const element = document.querySelector(selector);
        if (element) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = text;
            } else {
                element.textContent = text;
            }
        }
    });

    // Update placeholders
    const textContent = document.getElementById('textContent');
    if (textContent) textContent.placeholder = t.textPlaceholder;

    const passwordContent = document.getElementById('passwordContent');
    if (passwordContent) passwordContent.placeholder = t.passwordPlaceholder;

    // Update file upload text
    const uploadPlaceholder = document.querySelector('.upload-placeholder p');
    if (uploadPlaceholder) uploadPlaceholder.textContent = t.fileUploadText;

    const fileLimit = document.querySelector('.file-limit');
    if (fileLimit) fileLimit.textContent = t.fileUploadLimit;

    // Update expiry options
    const expiryOptions = document.querySelectorAll('#expiryTime option');
    if (expiryOptions.length >= 4) {
        expiryOptions[0].textContent = t.expiry1h;
        expiryOptions[1].textContent = t.expiry24h;
        expiryOptions[2].textContent = t.expiry3d;
        expiryOptions[3].textContent = t.expiry7d;
    }

    // Update content type labels
    const contentHeader = document.querySelector('.content-header span');
    if (contentHeader) {
        const isPassword = contentHeader.textContent.includes('ë¹„ë°€ë²ˆí˜¸') ||
                          contentHeader.textContent.includes('Password') ||
                          contentHeader.textContent.includes('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰') ||
                          contentHeader.textContent.includes('å¯†ç ');
        contentHeader.textContent = isPassword ? t.passwordLabel : t.textLabel;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize theme and language
    setTheme(currentTheme);
    updateLanguageDisplay();
    updatePageContent();

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }

    // Language selector
    const languageBtn = document.querySelector('.language-btn');
    const languageDropdown = document.querySelector('.language-dropdown');

    if (languageBtn && languageDropdown) {
        languageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            languageDropdown.classList.toggle('active');
        });

        document.addEventListener('click', () => {
            languageDropdown.classList.remove('active');
        });

        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                setLanguage(option.dataset.lang);
                languageDropdown.classList.remove('active');
            });
        });
    }
    // íƒ­ ì „í™˜
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tab = button.dataset.tab;

            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            button.classList.add('active');
            document.querySelector(`.tab-content[data-tab="${tab}"]`).classList.add('active');
        });
    });

    // íŒŒì¼ ì—…ë¡œë“œ
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const removeFileBtn = document.getElementById('removeFile');
    let uploadedFile = null;

    if (fileUploadArea) {
        fileUploadArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 10 * 1024 * 1024) {
                    showNotification(translations[currentLang].fileSizeError, 'error');
                    return;
                }
                uploadedFile = file;
                fileName.textContent = file.name;
                fileUploadArea.querySelector('.upload-placeholder').style.display = 'none';
                fileInfo.style.display = 'flex';
            }
        });

        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            uploadedFile = null;
            fileInput.value = '';
            fileUploadArea.querySelector('.upload-placeholder').style.display = 'block';
            fileInfo.style.display = 'none';
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, () => {
                fileUploadArea.classList.add('drag-over');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, () => {
                fileUploadArea.classList.remove('drag-over');
            });
        });

        fileUploadArea.addEventListener('drop', (e) => {
            const file = e.dataTransfer.files[0];
            if (file) {
                if (file.size > 10 * 1024 * 1024) {
                    showNotification(translations[currentLang].fileSizeError, 'error');
                    return;
                }
                uploadedFile = file;
                fileName.textContent = file.name;
                fileUploadArea.querySelector('.upload-placeholder').style.display = 'none';
                fileInfo.style.display = 'flex';
            }
        });
    }

    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì²´í¬ (í–¥ìƒëœ ë²„ì „)
    const passwordInput = document.getElementById('passwordContent');
    const passwordStrength = document.getElementById('passwordStrength');

    if (passwordInput) {
        passwordInput.addEventListener('input', (e) => {
            const password = e.target.value;
            let strength = 0;

            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 25;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 15;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 10;

            let strengthColor;
            if (strength < 40) {
                strengthColor = '#ef4444';
            } else if (strength < 70) {
                strengthColor = '#f59e0b';
            } else {
                strengthColor = '#10b981';
            }

            passwordStrength.style.setProperty('--strength-width', strength + '%');
            passwordStrength.style.setProperty('--strength-color', strengthColor);
        });
    }

    // í¼ ì œì¶œ
    const shareForm = document.getElementById('shareForm');
    const submitBtn = document.getElementById('submitBtn');
    const resultContainer = document.getElementById('resultContainer');
    const shareUrlInput = document.getElementById('shareUrl');

    if (shareForm) {
        shareForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
            const expiresInHours = parseInt(document.getElementById('expiryTime').value);

            let requestData = {
                dataType: activeTab.toUpperCase(),
                expiresInHours: expiresInHours
            };

            if (activeTab === 'text') {
                const content = document.getElementById('textContent').value.trim();
                if (!content) {
                    showNotification(translations[currentLang].textRequired, 'error');
                    return;
                }
                requestData.content = content;
            } else if (activeTab === 'password') {
                const content = document.getElementById('passwordContent').value.trim();
                if (!content) {
                    showNotification(translations[currentLang].passwordRequired, 'error');
                    return;
                }
                requestData.content = content;
            } else if (activeTab === 'file') {
                if (!uploadedFile) {
                    showNotification(translations[currentLang].fileRequired, 'error');
                    return;
                }

                const fileData = await fileToBase64(uploadedFile);
                requestData.fileData = fileData;
                requestData.fileName = uploadedFile.name;
                requestData.fileType = uploadedFile.type;
            }

            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = `<span style="display: inline-flex; align-items: center; gap: 8px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;"><circle cx="12" cy="12" r="10" opacity="0.25"/><path d="M12 2a10 10 0 0 1 10 10" opacity="0.75"/></svg>${translations[currentLang].creatingBtn}</span>`;

            try {
                const response = await fetch('/api/share', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (result.success) {
                    shareUrlInput.value = result.shareUrl;

                    // Smooth transition
                    shareForm.style.opacity = '0';
                    shareForm.style.transform = 'translateY(-20px)';
                    shareForm.style.transition = 'all 0.4s ease';

                    setTimeout(() => {
                        shareForm.style.display = 'none';
                        resultContainer.style.display = 'block';
                        resultContainer.style.opacity = '0';
                        resultContainer.style.transform = 'translateY(20px)';

                        setTimeout(() => {
                            resultContainer.style.transition = 'all 0.4s ease';
                            resultContainer.style.opacity = '1';
                            resultContainer.style.transform = 'translateY(0)';
                        }, 50);
                    }, 400);
                } else {
                    showNotification(result.message || translations[currentLang].serverError, 'error');
                }
            } catch (error) {
                showNotification(translations[currentLang].serverError, 'error');
                console.error(error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.textContent = originalText;
            }
        });
    }

    // ë³µì‚¬ ë²„íŠ¼ (í–¥ìƒëœ ë²„ì „)
    const copyBtn = document.getElementById('copyBtn');
    if (copyBtn) {
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(shareUrlInput.value);

                const originalText = copyBtn.textContent;
                copyBtn.innerHTML = `<span style="display: inline-flex; align-items: center; gap: 6px;">${translations[currentLang].copiedBtn}</span>`;
                copyBtn.style.background = 'linear-gradient(135deg, #10b981, #34d399)';

                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '';
                }, 2000);

                showNotification(translations[currentLang].linkCopied, 'success');
            } catch (err) {
                // Fallback for older browsers
                shareUrlInput.select();
                document.execCommand('copy');
                showNotification(translations[currentLang].linkCopied, 'success');
            }
        });
    }

    // ìƒˆë¡œ ë§Œë“¤ê¸° ë²„íŠ¼
    const createNewBtn = document.getElementById('createNewBtn');
    if (createNewBtn) {
        createNewBtn.addEventListener('click', () => {
            location.reload();
        });
    }

    // ì»¨í…ì¸  ë³µì‚¬ ë²„íŠ¼ (í–¥ìƒëœ ë²„ì „)
    const copyContentBtns = document.querySelectorAll('.copy-content-btn');
    copyContentBtns.forEach(btn => {
        btn.addEventListener('click', async () => {
            const content = btn.dataset.content;
            try {
                await navigator.clipboard.writeText(content);
                const originalText = btn.textContent;
                btn.innerHTML = translations[currentLang].copiedBtn;
                btn.style.background = 'linear-gradient(135deg, #10b981, #34d399)';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);

                showNotification(translations[currentLang].contentCopied, 'success');
            } catch (err) {
                showNotification(translations[currentLang].copyFailed, 'error');
            }
        });
    });

    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
    const downloadBtns = document.querySelectorAll('.download-btn');
    downloadBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const filename = btn.dataset.filename;
            const filetype = btn.dataset.filetype;
            const filedata = btn.dataset.filedata;

            const link = document.createElement('a');
            link.href = `data:${filetype};base64,${filedata}`;
            link.download = filename;
            link.click();
        });
    });

    // íŒŒì¼ì„ Base64ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                const base64 = reader.result.split(',')[1];
                resolve(base64);
            };
            reader.onerror = error => reject(error);
        });
    }

    // ì• í”Œ ìŠ¤íƒ€ì¼ ì•Œë¦¼ í•¨ìˆ˜
    function showNotification(message, type = 'info') {
        // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
        const existingNotification = document.querySelector('.apple-notification');
        if (existingNotification) {
            existingNotification.remove();
        }

        const notification = document.createElement('div');
        notification.className = 'apple-notification';

        const bgColors = {
            success: 'rgba(52, 199, 89, 0.95)',
            error: 'rgba(255, 59, 48, 0.95)',
            info: 'rgba(0, 122, 255, 0.95)'
        };

        const darkBgColors = {
            success: 'rgba(48, 209, 88, 0.95)',
            error: 'rgba(255, 69, 58, 0.95)',
            info: 'rgba(10, 132, 255, 0.95)'
        };

        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const bgColor = isDark ? darkBgColors[type] : bgColors[type];

        notification.style.cssText = `
            position: fixed;
            top: 32px;
            right: 32px;
            padding: 14px 20px;
            background: ${bgColor};
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15), 0 0 1px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            font-size: 0.9375rem;
            z-index: 10000;
            transform: translateY(-100px) scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.28, 0, 0.42, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.003em;
            max-width: 400px;
        `;

        const icons = {
            success: 'âœ“',
            error: 'âœ•',
            info: 'â„¹'
        };

        notification.innerHTML = `<span style="font-size: 1.125rem;">${icons[type]}</span><span>${message}</span>`;

        document.body.appendChild(notification);

        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                notification.style.transform = 'translateY(0) scale(1)';
                notification.style.opacity = '1';
            });
        });

        setTimeout(() => {
            notification.style.transform = 'translateY(-20px)';
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ ë° ë°˜ì‘í˜• ì•Œë¦¼ ìŠ¤íƒ€ì¼ ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .apple-notification {
                right: 20px !important;
                left: 20px !important;
                max-width: none !important;
                font-size: 0.875rem !important;
            }
        }

        @media (max-width: 480px) {
            .apple-notification {
                top: 24px !important;
                right: 16px !important;
                left: 16px !important;
                padding: 12px 16px !important;
                font-size: 0.8125rem !important;
            }
        }
    `;
    document.head.appendChild(style);

    // í˜ì´ì§€ ë¡œë“œ ì• ë‹ˆë©”ì´ì…˜
    document.body.style.opacity = '0';
    window.addEventListener('load', () => {
        document.body.style.transition = 'opacity 0.6s ease';
        document.body.style.opacity = '1';
    });

    // í¼ ì¸í’‹ì— í¬ì»¤ìŠ¤ íš¨ê³¼ ì¶”ê°€
    const inputs = document.querySelectorAll('textarea, input[type="text"]');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        });
    });
});